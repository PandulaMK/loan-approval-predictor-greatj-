<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Loan Approval Prediction System</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#101a33;
      --muted:#9fb0d0;
      --text:#e9eeff;
      --line:rgba(255,255,255,.10);
      --primary:#2563eb;
      --primary2:#1e4fd8;
      --good:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, rgba(37,99,235,.25), transparent 60%),
                  radial-gradient(1000px 500px at 90% 10%, rgba(34,197,94,.16), transparent 60%),
                  var(--bg);
      color:var(--text);
      padding:42px 16px;
    }
    .wrap{max-width:980px;margin:0 auto}
    .header{
      text-align:center;
      margin-bottom:18px;
    }
    .header h1{
      margin:0;
      font-size:34px;
      letter-spacing:.3px;
    }
    .header p{
      margin:8px 0 0;
      color:var(--muted);
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      padding:22px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-top:14px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    label{
      font-size:13px;
      color:var(--muted);
      font-weight:650;
    }
    input, select{
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px 12px;
      color:var(--text);
      outline:none;
      transition: .15s ease;
    }
    input::placeholder{color:rgba(233,238,255,.45)}
    input:focus, select:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 0 0 4px rgba(37,99,235,.15);
    }
    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-top:14px;
    }
    .btn{
      margin-top:18px;
      width:100%;
      padding:14px 16px;
      border:none;
      border-radius:14px;
      background: linear-gradient(90deg, var(--primary), #5b8cff);
      color:white;
      font-weight:800;
      letter-spacing:.2px;
      cursor:pointer;
      transition:.15s ease;
    }
    .btn:hover{transform: translateY(-1px); background: linear-gradient(90deg, var(--primary2), #4f84ff);}
    .note{
      margin-top:10px;
      color:rgba(233,238,255,.55);
      font-size:12.5px;
      text-align:center;
    }
    .result{
      margin-top:18px;
      border-radius:16px;
      border:1px solid var(--line);
      padding:16px;
      background: rgba(0,0,0,.18);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      font-weight:800;
      font-size:13px;
      letter-spacing:.2px;
    }
    .pill.good{background: rgba(34,197,94,.16); color:#b7ffd0; border:1px solid rgba(34,197,94,.25);}
    .pill.bad{background: rgba(239,68,68,.16); color:#ffd1d1; border:1px solid rgba(239,68,68,.25);}
    .pill.warn{background: rgba(245,158,11,.16); color:#ffe7b3; border:1px solid rgba(245,158,11,.25);}
    .kpi{
      display:grid;
      grid-template-columns: 1.2fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    .kpi .box{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background: rgba(255,255,255,.04);
    }
    .kpi .box .t{color:var(--muted); font-size:12px; font-weight:650}
    .kpi .box .v{font-size:22px; font-weight:900; margin-top:6px}
    .small{color:rgba(233,238,255,.60); font-size:12px; margin-top:8px}
    .full{grid-column: 1 / -1;}
    @media (max-width: 820px){
      .grid{grid-template-columns:1fr}
      .kpi{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>Loan Approval Prediction System</h1>
      <p>Enter applicant details to predict the probability of loan approval (Greatj – Kaggle).</p>
    </div>

    <div class="card">
      <form method="POST" action="/" id="loanForm" novalidate>
        <div class="grid">
          <div class="field">
            <label for="person_age">Age</label>
            <input id="person_age" name="person_age" type="number" min="18" max="100" step="1"
                   placeholder="e.g., 25" required value="{{ inputs.get('person_age','') }}">
          </div>

          <div class="field">
            <label for="person_income">Annual Income</label>
            <input id="person_income" name="person_income" type="number" min="0" step="1"
                   placeholder="e.g., 45000" required value="{{ inputs.get('person_income','') }}">
          </div>

          <div class="field">
            <label for="person_home_ownership">Home Ownership</label>
            <select id="person_home_ownership" name="person_home_ownership" required>
              {% set v = inputs.get('person_home_ownership','RENT') %}
              <option value="RENT" {{ 'selected' if v=='RENT' else '' }}>RENT</option>
              <option value="OWN" {{ 'selected' if v=='OWN' else '' }}>OWN</option>
              <option value="MORTGAGE" {{ 'selected' if v=='MORTGAGE' else '' }}>MORTGAGE</option>
              <option value="OTHER" {{ 'selected' if v=='OTHER' else '' }}>OTHER</option>
            </select>
          </div>

          <div class="field">
            <label for="person_emp_length">Employment Length (years)</label>
            <input id="person_emp_length" name="person_emp_length" type="number" min="0" step="0.1"
                   placeholder="e.g., 3.5" required value="{{ inputs.get('person_emp_length','') }}">
          </div>

          <div class="field">
            <label for="loan_intent">Loan Intent</label>
            <select id="loan_intent" name="loan_intent" required>
              {% set li = inputs.get('loan_intent','PERSONAL') %}
              <option value="EDUCATION" {{ 'selected' if li=='EDUCATION' else '' }}>EDUCATION</option>
              <option value="MEDICAL" {{ 'selected' if li=='MEDICAL' else '' }}>MEDICAL</option>
              <option value="VENTURE" {{ 'selected' if li=='VENTURE' else '' }}>VENTURE</option>
              <option value="PERSONAL" {{ 'selected' if li=='PERSONAL' else '' }}>PERSONAL</option>
              <option value="DEBTCONSOLIDATION" {{ 'selected' if li=='DEBTCONSOLIDATION' else '' }}>DEBT CONSOLIDATION</option>
              <option value="HOMEIMPROVEMENT" {{ 'selected' if li=='HOMEIMPROVEMENT' else '' }}>HOME IMPROVEMENT</option>
            </select>
          </div>

          <div class="field">
            <label for="loan_grade">Loan Grade</label>
            {% set lg = inputs.get('loan_grade','B') %}
            <select id="loan_grade" name="loan_grade" required>
              <option value="A" {{ 'selected' if lg=='A' else '' }}>A</option>
              <option value="B" {{ 'selected' if lg=='B' else '' }}>B</option>
              <option value="C" {{ 'selected' if lg=='C' else '' }}>C</option>
              <option value="D" {{ 'selected' if lg=='D' else '' }}>D</option>
              <option value="E" {{ 'selected' if lg=='E' else '' }}>E</option>
              <option value="F" {{ 'selected' if lg=='F' else '' }}>F</option>
              <option value="G" {{ 'selected' if lg=='G' else '' }}>G</option>
            </select>
          </div>

          <div class="field">
            <label for="loan_amnt">Loan Amount</label>
            <input id="loan_amnt" name="loan_amnt" type="number" min="0" step="1"
                   placeholder="e.g., 8000" required value="{{ inputs.get('loan_amnt','') }}">
          </div>

          <div class="field">
            <label for="loan_int_rate">Interest Rate (%)</label>
            <input id="loan_int_rate" name="loan_int_rate" type="number" min="0" step="0.01"
                   placeholder="e.g., 10.50" required value="{{ inputs.get('loan_int_rate','') }}">
          </div>

          <div class="field">
            <label for="loan_percent_income">Loan % of Income (auto)</label>
            <input id="loan_percent_income" name="loan_percent_income" type="number"
                   min="0" step="0.0001" readonly
                   placeholder="Auto-calculated" required value="{{ inputs.get('loan_percent_income','') }}">
          </div>

          <div class="field">
            <label for="cb_person_default_on_file">Default on File</label>
            {% set d = inputs.get('cb_person_default_on_file','N') %}
            <select id="cb_person_default_on_file" name="cb_person_default_on_file" required>
              <option value="Y" {{ 'selected' if d=='Y' else '' }}>YES</option>
              <option value="N" {{ 'selected' if d=='N' else '' }}>NO</option>
            </select>
          </div>

          <div class="field full">
            <label for="cb_person_cred_hist_length">Credit History Length (years)</label>
            <input id="cb_person_cred_hist_length" name="cb_person_cred_hist_length" type="number"
                   min="0" step="1" placeholder="e.g., 5" required
                   value="{{ inputs.get('cb_person_cred_hist_length','') }}">
          </div>
        </div>

        <button class="btn" type="submit">Predict Loan Approval</button>
        <div class="note">Loan % of Income is calculated as <b>loan amount ÷ annual income</b>.</div>
      </form>

      {% if result %}
        <div class="result" id="resultBox">
          {% if result.get('error') %}
            <div class="pill warn">⚠ Error</div>
            <div class="small"> {{ result.get('error') }} </div>
          {% else %}
            {% if result.decision == 'APPROVED' %}
              <div class="pill good">✅ APPROVED</div>
            {% else %}
              <div class="pill bad">⛔ REJECTED</div>
            {% endif %}

            <div class="kpi">
              <div class="box">
                <div class="t">Approval Probability</div>
                <div class="v">{{ '%.4f'|format(result.probability) }}</div>
                <div class="small">This is the model’s confidence for class <b>1</b> (approved).</div>
              </div>
              <div class="box">
                <div class="t">Decision Threshold</div>
                <div class="v">0.50</div>
                <div class="small">If probability ≥ 0.50 → Approved, else Rejected.</div>
              </div>
            </div>
          {% endif %}
        </div>

        <script>
          // Auto-scroll to result after prediction
          document.getElementById("resultBox").scrollIntoView({behavior:"smooth", block:"start"});
        </script>
      {% endif %}
    </div>
  </div>

  <script>
    function calcLoanPercentIncome() {
      const incomeEl = document.getElementById("person_income");
      const loanEl   = document.getElementById("loan_amnt");
      const outEl    = document.getElementById("loan_percent_income");

      const income = parseFloat(incomeEl.value);
      const loan = parseFloat(loanEl.value);

      if (!isFinite(income) || income <= 0 || !isFinite(loan) || loan < 0) {
        outEl.value = "";
        return;
      }

      const ratio = loan / income;
      outEl.value = ratio.toFixed(4); // 4dp is enough for this feature
    }

    document.getElementById("person_income").addEventListener("input", calcLoanPercentIncome);
    document.getElementById("loan_amnt").addEventListener("input", calcLoanPercentIncome);

    // Calculate on load (when page reloads after POST)
    window.addEventListener("load", calcLoanPercentIncome);
  </script>
</body>
</html>
